# 2020_BackendStudy
소셜 커머스를 만들며 공부한 백엔드 

그림까지 첨부하며 기록할 시간이 없기에

딱딱하게 글로만 기록을 남긴다.

- [2020_BackendStudy](#2020_backendstudy)
- [1. JetBrains 무료 이용](#1-jetbrains-무료-이용)
- [2. Git 관련 공부](#2-git-관련-공부)
  - [2.1 Git이란? (간단한 명령어 설명)](#21-git이란-간단한-명령어-설명)
  - [2.2 Git의 장점](#22-git의-장점)
  - [2.3 지금까지 사용한 명령어 정리](#23-지금까지-사용한-명령어-정리)
  - [2.4 Pycharm을 이용한 git](#24-pycharm을-이용한-git)
  - [2.5 PR이란?](#25-pr이란)
- [3. Docker](#3-docker)
- [4. 서버 구축](#4-서버-구축)
  - [4.1 AWS 계정 생성 및 IAM 사용자 생성](#41-aws-계정-생성-및-iam-사용자-생성)
    - [4.1.1 AWS 계정 생성](#411-aws-계정-생성)
    - [4.1.2 IAM 사용자 생성](#412-iam-사용자-생성)
      - [IAM 사용자란?](#iam-사용자란)
      - [IAM 사용자 사용하기](#iam-사용자-사용하기)
  - [4.2 EC2, RDS 서버 생성하기](#42-ec2-rds-서버-생성하기)
    - [4.2.1 EC2 생성](#421-ec2-생성)
    - [4.2.2 RDS 생성](#422-rds-생성)
    - [4.2.3 보안 그룹](#423-보안-그룹)
  - [4.3 DNS(도메인 네임 서버)](#43-dns도메인-네임-서버)
  - [4.4 SSL 인증(AWS Certification Manager 이용)](#44-ssl-인증aws-certification-manager-이용)
    - [4.4.1 Route 53](#441-route-53)
    - [4.4.2 AWS Certification Manager](#442-aws-certification-manager)
    - [4.4.3 Load Balancing](#443-load-balancing)


# 1. JetBrains 무료 이용

2020년 현재 JetBrains에서는 대학생에게 무료로 여러 개발 도구들을 무료로 사용할 수 있게 하였다.

우리 백엔드 팀은 django를 사용하여 서버를 개발하기 때문에 Pycharm Professional 버젼을 다운 받았다.

(Support에 Academic Licensing을 통해 인증을 하면 된다.)

# 2. Git 관련 공부 

## 2.1 Git이란? (간단한 명령어 설명)

맨 처음 컴퓨터소프트웨어학과에 들어갔을 때, 몇몇의 교수님들은 git을 통해 과제를 제출하게 한다.

그때는 git이 무엇인지 전혀 몰라 사용함에 있어서 정말 많을 불편함을 느꼈지만, 점점 사용할 수록 너무나도 많을 장점들이 있음을 알아갔다.

git이란 하나의 폴더에 대해 기록을 남기는 것이다.

git add를 통해 어떤 파일들의 기록을 남길지 정하고

추가, 수정, 제거된 내용들을 git commit할 때마다 기록을 추가하고 

git push를 통해 네이버 클라우드처럼 서버에 저장을 할 수 있다.

## 2.2 Git의 장점

개발 할때 가장 골치 아픈 점이 코드에서 조그마한 부분을 수정했을 때 전체 코드가 돌아가지 않을 때이다.

이러한 불상사가 일어나지 않도록, 매 기능을 구현할 때마다 git commit을 하면 언제든지 그 상태로 돌아갈 수 있고

현재 코드와의 차이점 비교도 쉽다. 보통 코드 수정은 한두줄 혹은 한 부분만 하지 않기 때문에 이 기능을 저장 유용한다.

또한 여러명의 개발자가 개발을 할 때, git에 여러 branch들을 생성해 서로 확인한 branch만 merge를 하여 개발할 때도 편리하게 쓰인다.

여기서 branch란 하나의 폴더에 대해 여러명이 가지고 있는 각자의 수정본이라 생각하면 된다. 주로 수정된 내용이 서로 다르고 보통 수정이 끝난 후 하나의 branch로 합쳐서(merge) 하나의 완성본으로 만든다.

## 2.3 지금까지 사용한 명령어 정리

```
git clone {git 장소} : 서버에 존재하는 폴더를 복사해 온다.

git add . : 모든 파일에 대한 기록을 남기도록 한다.

git commit -m "{수정된 내용}" : 변경된 내용을 기록한다.

git push {원하는 branch} : 서버에도 저장한다.

git pull {원하는 커밋} : 서버에 변경사항이 있으면 불러온다.

git log : 현재까지의 커밋 기록을 확인한다.

git branch : 현재 branch를 확인한다.

git checkout {브렌치 명} : 해당 branch로 변경.
```


## 2.4 Pycharm을 이용한 git

보통 개발도구들은 git과 연동하여 버튼 하나로 

add, commit, push 등을 할 수 있도록 기능을 제공한다.

수정 후 올리려면 다음과 같다.

- pycharm 위 탭에서 VCS → Git → Branches 선택 (단축키 ctrl + shift  + ` )
- New Branch →  Branch 명 정하기 → checkout
- 수정 후 우측 상단 commit 버튼 ( 단축키 ctrl + k) 후
- develop branch로 push ( 단축키 ctrl + shit + k)


## 2.5 PR이란?

이번에 개발하면서 처음 알게된 내용이다.

PR이란 pull request로 git hub에서 제공하는 하나의 기능이다.

서로 다른 브렌치에서 커밋시 그 내용에 대해 

메인 브렌치로 merge하기 전 다른 사람이 확인 할 수 있도록 하는 것이다.

그리고 개발시에는 Branch 명, commit 내용, pr 내용 작성 등의 형식을 모두 정해 그 형식에 맞게 기록한다.

# 3. Docker 

처음으로 맡은 일은 개발환경을 세팅하는 것이였다.

아직 수정될 부분이 있어서 나중에 추가할 예정이다.


# 4. 서버 구축 

다음으로 내가 맡은 일은 기본적인 서버를 구축하는 일이다.

해야되는 일은 다음과 같다.

1. AWS 계정 생성 및 IAM 사용자 생성
2. AWS EC2, RDS를 통해 서버, DB 생성
3. DNS 연결하기
4. SSL 인증 

개인적으로 SSL이 가장 어지러웠던 것 같다.

## 4.1 AWS 계정 생성 및 IAM 사용자 생성

### 4.1.1 AWS 계정 생성

이 일은 정말 간단한 일이다. 

이메일과 해외결제가 가능한 카드만 있으면 누구나 할 수 있기에 자세한 설명은 생략한다. 

~~(사실 기입해야 정보를 제대로 쓰지 않아도 가입된다.)~~

### 4.1.2 IAM 사용자 생성 

#### IAM 사용자란?

Root 권한, 즉 모든 기능을 사용할 수 있다는 것은 편리한 일이다.

하지만 그 기능들이 무엇인지 모른다면 아무거나 함부로 건드리지 않는 것이 좋다.

AWS에서는 몇몇 기능들을 잘못 건드렸다가 돈이 어마어마하게 청구될 수도 있고, 서버가 한 순간에 망가질 수도 있다.

이러한 위험도 있고 개발을 위해 여러 명의 사용자가 하나의 root 계정을 사용하는 것은 비효율적이기 때문에

AWS에서는 하나의 Root 계정에 여러 IAM 사용자를 생성 가능하게 하여

여러 개발자가 구분된(제한된) 서비스를 각자 사용할 수 있도록 하였다.

Root 계정을 소유한 사람이 다른 IAM 활동 기록들을 확인 할 수 있고, Root 계정을 소유한 사람만이 사용자 정보를 볼 수 있기 때문에 보안적으로도 유리하다.

#### IAM 사용자 사용하기

1. Root 계정으로 접속하여 IAM Management에 접속 
2. 그룹 생성
3. 사용자 생성
4. 아이디를 지정하면 자동으로 password를 생성해 준다.
5. 해당 IAM 사용자가 접속할 수 있는 URL도 제공한다.

**해당 아이디 비번은 평범한 로그인이 아니라 제공되는 URL에서만 로그인이 가능하다.**

IAM 사용자를 생성하는 것은 상당히 간단하다.

하지만 그 사용자에게 제공할 수 있는 기능의 종류가 정말 다양하기 때문에 어떤 기능을 제공할 지는 고민이 조금 되었다.

## 4.2 EC2, RDS 서버 생성하기 

### 4.2.1 EC2 생성

우리 팀은 Ubuntu 18.04 LTS 버젼을 사용하여 만들었다.

돈을 들이고 싶지 않다면 그냥 프리티어라고 써 있는 것만 골라서 다음을 누르면 된다.

개발자라면 개발 목적에 맞게 적당히 선택하면 된다.
(나중에 production 서버 개발시 내용 더 추가할 듯)


한 가지 중요한 점은 인스턴스 생성시 개인 키를 생성하게 되는데

이 키로 이 인스턴스에 접속할 수 있으니 잘 간직하도록 하자.

유출 시에는 서버가 털릴 수도 있다.


### 4.2.2 RDS 생성

우리 팀은 Postgresql을 쓴다.

이 부분도 돈을 쓰고 싶지 않다면 프리티어 골라서 다음을 누르면 된다. 

(가끔 자동 스케일링이 체크 되어 있는데 이 부분은 초과 사용에 대해서 자동으로 요금을 내는 것이니 주의)

여러 정보를 기입하는데

root 계정 아이디와 비밀번호를 철저히 설정하는 것이 좋다.
~~(기본 아이디 admin 에 비밀번호 qwer1234 설정했다가 DB를 다 털린 적 있다.)~~

중국 해커들이 AWS IP를 호시탐탐 노리고 있으니 조심하자!

이 부분도 자세한 정보에 대해서는 나중에 추가할 듯 하다.

### 4.2.3 보안 그룹

AWS에서는 서버에 접근하는 모든 커넥션들을 쉽게 차단할 수 있도록 기능을 제공하고 있다.   
~~(원래 직접 코드로 한줄 한줄 코딩해야된다. 이제 옛날일)~~


EC2에서 왼쪽 밑에를 잘 보면 보안 그룹이 있는데

원래는 인스턴스(EC2, RDS 등을 지칭함) 생성시에 지정하는데

나중에 추가, 수정도 가능하다.

보안 그룹하나를 눌러오면 두 가지가 보이는데

인바운드 규칙은 들어오는 프로토콜들을 조절하고 

보통 SSH, HTTP, HTTPS는 모든 소스에도 들어오도록 설정한다.

(SSH는 키 인증을 따로 하기에 모든 소스에도 들어오게 해도 안전하다.)

아웃바운드 규칙은 서버에서 내보내는 프로토콜을 조절하는 것으로 모든 트래픽을 내보내도록 해도 상관을 없다.

## 4.3 DNS(도메인 네임 서버)

원래 서버는 IP주소를 통해서만 접속할 수 있다.

하지만 딱딱하게 숫자로만 이루어진 IP주소는 기억하기도 쉽지 않고 일일이 치기도 어렵다.

그래서 도메인 네임 서버라는 것을 만들었는데 

이것은 간단한 www.naver.com 처럼 인식하기도 쉽고 기억에도 잘 남는 도메인 네임을 IP주소로 연결해 주도록 하는 것이다.


우리 팀은 Gabia라는 업체에서 ----.com이라는 도메인 네임을 구매하였고

(구매 방법은 간단하다. 해당 사이트에서 주소를 검색하면 가격이 책정되어 나온다. 그 중에서 골라서 구매하면 된다.)

(도메인 뒤에 부는 .com, .net마다 가격이 다른 것으로 보아 차이가 있는 것 같은데 아직은 잘 모르겠다.)

도메인 네임과 IP주소를 연결하는 방법은 다음과 같다.

1. 내 gabia 정보
2. DNS 관리
3. 레코드 추가 
4. 해당 IP 주소 입력
5. 저장

몇 분 안되서 그 도메인 네임으로 들어가면 해당 IP가 연결되어 있다.

AWS Certification을 쓸 예정이라 필자는 조금 다르게 연결하였다.

이 내용은 SSL 연결과 관련하여 설명할 예정이다.

## 4.4 SSL 인증(AWS Certification Manager 이용)

SSL 인증이란 통신을 할 때 정보들을 암호화 시켜 주고 받도록 하는 것이다. SSL 인증이 된 서버는 https로 접속이 가능하다.

좀 더 자세하게 말하자면, 암호화 비대칭키를 생성하여 공개키를 통해 정보를 암호화해 주고 받고 개인키를 통해 복호화한다.

~~요즘 시대에 https가 아니면 서버로 인정 못 받는다.~~

서버에서 직접 cerbot을 깔고 프로그램을 실행해서 웹서버와 연결해 SSL 인증을 한 적이 있었지만

(3개월마다 인증을 갱신해야 된다는 단점이 있다.)

이번에는 AWS 기능들을 많이 활용해 보기 위해 AWS Certification Manager을 이용해 보았다.


### 4.4.1 Route 53

SSL 인증에 앞서 Route 53에 대해 알아보자.

Route 53란 구매한 도메인을 **AWS 네임 서버**를 통해 IP 연결할 수 있도록 하는 기능 제공한다.

원래 Gabia에서 도메인을 샀기 때문에 가비아 네임서버를 통해 IP주소로 연결이 되지만 

AWS의 다른 기능들을 사용하기 위해서는 도메인의 네임서버를 변경해야 되었다.

따라서 가비아에서 해당 도메인의 네임서버 설정을 다 AWS 네임서버로 변경시키고 해당 도메인을 Route 53에 추가하고 레코드들을 정의하였다. (호스팅 영역 생성)


레코드에는 여러가지 종류가 있는데 NS는 네임서버를 뜻하고, A레코드가 IP주소와의 연결을 뜻한다. 나머지는 구글링해보면 쉽게 찾을 수 있다.

### 4.4.2 AWS Certification Manager

갑자기 Route 53에 대해서 설명을 왜 했는지 궁금할 것이다.

SSL 암호화는 도메인 네임에 연결해서 이루어지기 때문에 

AWS에서 제공하는 SSL을 사용하려면 도메인도 AWS에 연결되어 있어야 한다. 

따라서 도메인을 연결하는 작업을 먼저 진행하였고 이제 인증을 받아보자.


1. Certification Manager 접속
2. 인증 요청
3. 공인 인증 클릭
4. 도메인 이름 추가
5. DNS 인증 클릭
6. 보류 상태의 인증 요청이 생기고 클릭해 보면
7. record 추가하기를 누른 후
8. 30분 정도 기다리면 인증완료가 되어 있다.

**주의점** 도메인 네임 입력시 앞에 아무것도 붙이지 않으면 모든 서브 도메인도 등록이 된다.

맨 처음에 *.---.com으로 입력하는 것인 줄 알았는데

---.com만 입력하면 되는 것이었다. (이것 때문에 하루를 고민했다.)

Certification Manager가 편리한 적은 SSL 인증을 자동으로 갱신해 준다. 

(필자의 생각에는 주기적으로 SSL 인증을 통해 브루트 포스를 통한 암호화키 추적을 불가능하게 하기 위함인 것 같다.)

### 4.4.3 Load Balancing

이제 정말 끝이다.

도메인도 등록하고 암호화 키도 생성했으니(SSL 인증)

서버에 적용시켜주기만 하면 된다.

EC2에 접속해서 왼쪽 아래를 보면 로드 밸런싱이라고 나와있다.

자세히는 구글링 치면 나오고 

인스턴스 앞단에서 인스턴스(들)로 연결시켜 주는 역할이는 하는 기능이다.

이 부분에서 인증서를 등록할 수 있고 

load balancer 생성 후 route 53에 등록해주면 

SSL 인증 끝!

방법은 다음 [링크](https://nerd-mix.tistory.com/35) 참고하세욤

